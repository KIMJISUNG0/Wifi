<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“¥ Receiver</title>
</head>
<body>
  <h1>ğŸ“¥ Receiver</h1>
  <p>ì—°ê²° ìƒíƒœ: <span id="status">ì—°ê²° ì•ˆë¨</span></p>
  <h3>ë°›ì€ ì‚¬ì§„:</h3>
  <img id="preview" style="max-width:100%; display:none;">
  <a id="download" style="display:none;">â¬‡ï¸ ë‹¤ìš´ë¡œë“œ</a>

  <script>
    const WS_URL = "wss://spring-salad-09fe.slvjek.workers.dev";
    const ws = new WebSocket(WS_URL);

    let meta = null;
    let chunks = [];

    ws.onopen = () => { document.getElementById('status').innerText = "âœ… ì—°ê²°ë¨"; };
    ws.onclose = () => { document.getElementById('status').innerText = "âŒ ëŠê¹€"; };

    ws.onmessage = (event) => {
      if (typeof event.data === "string") {
        // ë©”íƒ€ ì •ë³´ ìˆ˜ì‹ 
        try {
          const msg = JSON.parse(event.data);
          if (msg.type === "meta") {
            meta = msg;
            chunks = [];
          }
        } catch {}
      } else {
        // íŒŒì¼ ë°ì´í„° ìˆ˜ì‹ 
        chunks.push(event.data);
        if (meta) {
          const blob = new Blob(chunks, { type: meta.mime });
          const url = URL.createObjectURL(blob);

          // í™”ë©´ í‘œì‹œ
          const img = document.getElementById('preview');
          img.src = url;
          img.style.display = "block";

          // ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ
          const a = document.getElementById('download');
          a.href = url;
          a.download = meta.name;
          a.style.display = "inline-block";
        }
      }
    };
  </script>
</body>
</html>
