<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“¤ Sender</title>
  <style>
    body{font-family:system-ui;margin:16px}
    .row{margin:12px 0}
    #preview{max-width:100%;display:none;border:1px solid #ddd;padding:8px;border-radius:8px}
  </style>
</head>
<body>
  <h1>ğŸ“¤ Sender</h1>

  <div class="row">
    ì—°ê²° ìƒíƒœ: <b id="status">ì—°ê²° ì•ˆë¨</b>
  </div>

  <div class="row">
    <input type="file" id="fileInput" accept="image/*">
    <button id="sendFileBtn">ì‚¬ì§„ ì „ì†¡</button>
  </div>

  <img id="preview" alt="ë¯¸ë¦¬ë³´ê¸°"/>

  <script>
    // ë°˜ë“œì‹œ ë³¸ì¸ ì›Œì»¤ ì£¼ì†Œ í™•ì¸
    const WS_URL = "wss://spring-salad-09fe.slvjek.workers.dev";

    const ws = new WebSocket(WS_URL);
    const $ = id => document.getElementById(id);

    ws.onopen  = () => { $('status').textContent = 'âœ… ì—°ê²°ë¨'; };
    ws.onclose = () => { $('status').textContent = 'âŒ ëŠê¹€';   };
    ws.onerror = (e) => console.error('WS error:', e);

    $('sendFileBtn').onclick = async () => {
      const file = $('fileInput').files?.[0];
      if (!file) { alert('ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”!'); return; }
      if (ws.readyState !== WebSocket.OPEN) { alert('ì›¹ì†Œì¼“ì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'); return; }

      // ë¯¸ë¦¬ë³´ê¸°
      const url = URL.createObjectURL(file);
      $('preview').src = url; $('preview').style.display = 'block';

      // 1) íŒŒì¼ ë©”íƒ€ ë¨¼ì € ì „ì†¡
      ws.send(JSON.stringify({ type: 'meta', name: file.name, mime: file.type, size: file.size }));

      // 2) íŒŒì¼ ë‚´ìš© ì „ì†¡ (ì‘ì€ íŒŒì¼: í•œ ë²ˆì—)
      const buf = await file.arrayBuffer();
      ws.send(buf);

      alert('ì‚¬ì§„ ì „ì†¡ ì™„ë£Œ!');
    };
  </script>
</body>
</html>
